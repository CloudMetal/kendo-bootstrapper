("function"==typeof define&&define.amd?define:function(e,t){return t()})(["./kendo.core.min"],function(){!function(e,t){function n(t){return e.map(a(t),function(e){return e.name}).join(", ")}function a(e){var t=e[0];return t.files?o(t.files):[{name:s(t.value),extension:i(t.value),size:null}]}function o(t){return e.map(t,function(e){return r(e)})}function r(e){var t=e.name||e.fileName;return{name:_.htmlEncode(t),extension:i(t),size:e.size||e.fileSize,rawFile:e}}function i(e){var t=e.match(y);return t?t[0]:""}function s(e){var t=e.lastIndexOf("\\");return-1!=t?e.substr(t+1):e}function l(t,n,a){var o,r;n._supportsRemove()&&(o=t.data("fileNames"),r=e.map(o,function(e){return e.name}),n._submitRemove(r,a,function(e,a,r){n._removeFileEntry(t),n.trigger(S,{operation:"remove",files:o,response:e,XMLHttpRequest:r})},function(e){n.trigger(R,{operation:"remove",files:o,XMLHttpRequest:e}),F("Server response: "+e.responseText)}))}function p(t,n,a){var o=!1,r="";try{r=e.parseJSON(u(t)),o=!0}catch(i){a()}o&&n(r)}function u(e){return(t===e||""===e)&&(e="{}"),e}function d(e){e.stopPropagation(),e.preventDefault()}function c(e,t,n,a){var o,r;e.on("dragenter"+t,function(){n(),r=new Date,o||(o=setInterval(function(){var e=new Date-r;e>100&&(a(),clearInterval(o),o=null)},100))}).on("dragover"+t,function(){r=new Date})}function f(e){return e.children(".k-icon").is(".k-loading, .k-success, .k-fail")}function m(t){return e(t.target).closest(".k-file")}function h(){var n={},a=e("meta[name=csrf-token]").attr("content"),o=e("meta[name=csrf-param]").attr("content");return e("input[name^='__RequestVerificationToken']").each(function(){n[this.name]=this.value}),o!==t&&a!==t&&(n[o]=a),n}var v,g,_=window.kendo,k=_.ui.Widget,F=_.logToConsole,y=/\.([^\.]+)$/,w=".kendoUpload",U="select",b="upload",S="success",R="error",C="complete",x="cancel",A="progress",E="remove",q=k.extend({init:function(t,n){var a,o,r=this;k.fn.init.call(r,t,n),r.name=t.name,r.multiple=r.options.multiple,r.localization=r.options.localization,a=r.element,r.wrapper=a.closest(".k-upload"),0===r.wrapper.length&&(r.wrapper=r._wrapInput(a)),r._activeInput(a),r.toggle(r.options.enabled),o=r._ns=w+"-"+_.guid(),a.closest("form").on("submit"+o,e.proxy(r._onParentFormSubmit,r)).on("reset"+o,e.proxy(r._onParentFormReset,r)),r.options.async.saveUrl?(r._module=r._supportsFormData()?new g(r):new v(r),r._async=!0):r._module=new I(r),r._supportsDrop()&&r._setupDropZone(),r.wrapper.delegate(".k-upload-action","click",e.proxy(r._onFileAction,r)).delegate(".k-upload-selected","click",e.proxy(r._onUploadSelected,r))},events:[U,b,S,R,C,x,A,E],options:{name:"Upload",enabled:!0,multiple:!0,showFileList:!0,async:{removeVerb:"POST",autoUpload:!0},localization:{select:"Select...",cancel:"Cancel",retry:"Retry",remove:"Remove",uploadSelectedFiles:"Upload files",dropFilesHere:"drop files here to upload",statusUploading:"uploading",statusUploaded:"uploaded",statusFailed:"failed"}},setOptions:function(e){var t=this,n=t.element;k.fn.setOptions.call(t,e),t.multiple=t.options.multiple,n.attr("multiple",t._supportsMultiple()?t.multiple:!1),t.toggle(t.options.enabled)},enable:function(e){e=t===e?!0:e,this.toggle(e)},disable:function(){this.toggle(!1)},toggle:function(e){e=t===e?e:!e,this.wrapper.toggleClass("k-state-disabled",e),this.element.prop("disabled",e)},destroy:function(){var t=this;e(document).add(e(".k-dropzone",t.wrapper)).add(t.wrapper.closest("form")).off(t._ns),e(t.element).off(w),k.fn.destroy.call(t)},_addInput:function(t){if(t[0].nodeType){var n=this,a=t.clone().val("");a.insertAfter(n.element).data("kendoUpload",n),e(n.element).hide().removeAttr("id").off(w),n._activeInput(a)}},_activeInput:function(t){var n=this,a=n.wrapper;n.element=t,t.attr("multiple",n._supportsMultiple()?n.multiple:!1).attr("autocomplete","off").on("click"+w,function(e){a.hasClass("k-state-disabled")&&e.preventDefault()}).on("focus"+w,function(){e(this).parent().addClass("k-state-focused")}).on("blur"+w,function(){e(this).parent().removeClass("k-state-focused")}).on("change"+w,e.proxy(n._onInputChange,n))},_onInputChange:function(t){var n=this,o=e(t.target),r=n.trigger(U,{files:a(o)});r?(n._addInput(o),o.remove()):n._module.onSelect(t)},_onDrop:function(t){var n,a=t.originalEvent.dataTransfer,r=this,i=a.files;d(t),i.length>0&&(n=r.trigger(U,{files:o(i)}),n||r._module.onSelect({target:e(".k-dropzone",r.wrapper)},i))},_enqueueFile:function(t,n){var a,o,r=this,i=e(".k-upload-files",r.wrapper);return 0===i.length&&(i=e("<ul class='k-upload-files k-reset'></ul>").appendTo(r.wrapper),r.options.showFileList||i.hide()),a=e(".k-file",i),o=e("<li class='k-file'><span class='k-filename' title='"+t+"'>"+t+"</span></li>").appendTo(i).data(n),r._async&&o.prepend("<span class='k-icon'></span>"),!r.multiple&&a.length>0&&r._module.onRemove({target:e(a,r.wrapper)}),o},_removeFileEntry:function(t){var n,a=t.closest(".k-upload-files");t.remove(),n=e(".k-file",a),n.find("> .k-fail").length===n.length&&this._hideUploadButton(),0===n.length&&a.remove()},_fileAction:function(e,t){var n={remove:"k-delete",cancel:"k-cancel",retry:"k-retry"};n.hasOwnProperty(t)&&(this._clearFileAction(e),e.append(this._renderAction(n[t],this.localization[t]).addClass("k-upload-action")))},_fileState:function(e,t){var n,a=this.localization,o={uploading:{cssClass:"k-loading",text:a.statusUploading},uploaded:{cssClass:"k-success",text:a.statusUploaded},failed:{cssClass:"k-fail",text:a.statusFailed}},r=o[t];r&&(n=e.children(".k-icon").text(r.text),n[0].className="k-icon "+r.cssClass)},_renderAction:function(t,n){return""!==t?e("<button type='button' class='k-button k-button-icontext'><span class='k-icon "+t+"'></span>"+n+"</button>"):e("<button type='button' class='k-button'>"+n+"</button>")},_clearFileAction:function(e){e.find(".k-upload-action").remove()},_onFileAction:function(t){var n,a,o,r,i=this;return i.wrapper.hasClass("k-state-disabled")||(n=e(t.target).closest(".k-upload-action"),a=n.find(".k-icon"),o=n.closest(".k-file"),r={files:o.data("fileNames")},a.hasClass("k-delete")?i.trigger(E,r)||i._module.onRemove({target:e(o,i.wrapper)},r.data):a.hasClass("k-cancel")?(i.trigger(x,r),i._module.onCancel({target:e(o,i.wrapper)}),this._checkAllComplete()):a.hasClass("k-retry")&&i._module.onRetry({target:e(o,i.wrapper)})),!1},_onUploadSelected:function(){return this._module.onSaveSelected(),!1},_onFileProgress:function(t,n){var a=e(".k-progress-status",t.target);0===a.length&&(a=e("<span class='k-progress'><span class='k-state-selected k-progress-status' style='width: 0;'></span></span>").appendTo(e(".k-filename",t.target)).find(".k-progress-status")),a.width(n+"%"),this.trigger(A,{files:m(t).data("fileNames"),percentComplete:n})},_onUploadSuccess:function(e,t,n){var a=m(e);this._fileState(a,"uploaded"),this.trigger(S,{files:a.data("fileNames"),response:t,operation:"upload",XMLHttpRequest:n}),this._supportsRemove()?this._fileAction(a,E):this._clearFileAction(a),this._checkAllComplete()},_onUploadError:function(e,t){var n=m(e);this._fileState(n,"failed"),this._fileAction(n,"retry"),this.trigger(R,{operation:"upload",files:n.data("fileNames"),XMLHttpRequest:t}),F("Server response: "+t.responseText),this._checkAllComplete()},_showUploadButton:function(){var t=e(".k-upload-selected",this.wrapper);0===t.length&&(t=this._renderAction("",this.localization.uploadSelectedFiles).addClass("k-upload-selected")),this.wrapper.append(t)},_hideUploadButton:function(){e(".k-upload-selected",this.wrapper).remove()},_onParentFormSubmit:function(){var n,a=this,o=a.element;t!==this._module.onAbort&&this._module.onAbort(),o.value||(n=e(o),n.attr("disabled","disabled"),window.setTimeout(function(){n.removeAttr("disabled")},0))},_onParentFormReset:function(){e(".k-upload-files",this.wrapper).remove()},_supportsFormData:function(){return"undefined"!=typeof FormData},_supportsMultiple:function(){var e=this._userAgent().indexOf("Windows")>-1;return!(_.support.browser.opera||_.support.browser.safari&&e)},_supportsDrop:function(){var e=this._userAgent().toLowerCase(),t=/chrome/.test(e),n=!t&&/safari/.test(e),a=n&&/windows/.test(e);return!a&&this._supportsFormData()&&this.options.async.saveUrl},_userAgent:function(){return navigator.userAgent},_setupDropZone:function(){var t,n,a=this;e(".k-upload-button",this.wrapper).wrap("<div class='k-dropzone'></div>"),t=a._ns,n=e(".k-dropzone",a.wrapper).append(e("<em>"+a.localization.dropFilesHere+"</em>")).on("dragenter"+t,d).on("dragover"+t,function(e){e.preventDefault()}).on("drop"+t,e.proxy(this._onDrop,this)),c(n,t,function(){n.addClass("k-dropzone-hovered")},function(){n.removeClass("k-dropzone-hovered")}),c(e(document),t,function(){n.addClass("k-dropzone-active")},function(){n.removeClass("k-dropzone-active")})},_supportsRemove:function(){return!!this.options.async.removeUrl},_submitRemove:function(t,n,a,o){var r=this,i=r.options.async.removeField||"fileNames",s=e.extend(n,h());s[i]=t,jQuery.ajax({type:this.options.async.removeVerb,dataType:"json",dataFilter:u,url:this.options.async.removeUrl,traditional:!0,data:s,success:a,error:o})},_wrapInput:function(e){return e.wrap("<div class='k-widget k-upload'><div class='k-button k-upload-button'></div></div>"),e.closest(".k-button").append("<span>"+this.localization.select+"</span>"),e.closest(".k-upload")},_checkAllComplete:function(){0===e(".k-file .k-icon.k-loading",this.wrapper).length&&this.trigger(C)}}),I=function(e){this.name="syncUploadModule",this.element=e.wrapper,this.upload=e,this.element.closest("form").attr("enctype","multipart/form-data").attr("encoding","multipart/form-data")};I.prototype={onSelect:function(t){var o,r=this.upload,i=e(t.target);r._addInput(i),o=r._enqueueFile(n(i),{relatedInput:i,fileNames:a(i)}),r._fileAction(o,E)},onRemove:function(e){var t=m(e);t.data("relatedInput").remove(),this.upload._removeFileEntry(t)}},v=function(e){this.name="iframeUploadModule",this.element=e.wrapper,this.upload=e,this.iframes=[]},q._frameId=0,v.prototype={onSelect:function(t){var n=this.upload,a=e(t.target),o=this.prepareUpload(a);n.options.async.autoUpload?this.performUpload(o):(n._supportsRemove()&&this.upload._fileAction(o,E),n._showUploadButton())},prepareUpload:function(t){var o,r,i,s=this.upload,l=e(s.element),p=s.options.async.saveField||t.attr("name");return s._addInput(t),t.attr("name",p),o=this.createFrame(s.name+"_"+q._frameId++),this.registerFrame(o),r=this.createForm(s.options.async.saveUrl,o.attr("name")).append(l),i=s._enqueueFile(n(t),{frame:o,relatedInput:l,fileNames:a(t)}),o.data({form:r,file:i}),i},performUpload:function(t){var n,a,o,r={files:t.data("fileNames")},i=t.data("frame"),s=this.upload;if(s.trigger(b,r))s._removeFileEntry(i.data("file")),this.cleanupFrame(i),this.unregisterFrame(i);else{s._hideUploadButton(),i.appendTo(document.body),n=i.data("form").appendTo(document.body),r.data=e.extend({},r.data,h());for(a in r.data)o=n.find("input[name='"+a+"']"),0===o.length&&(o=e("<input>",{type:"hidden",name:a}).appendTo(n)),o.val(r.data[a]);s._fileAction(t,x),s._fileState(t,"uploading"),i.one("load",e.proxy(this.onIframeLoad,this)),n[0].submit()}},onSaveSelected:function(){var t=this;e(".k-file",this.element).each(function(){var n=e(this),a=f(n);a||t.performUpload(n)})},onIframeLoad:function(t){var n,a=e(t.target);try{n=a.contents().text()}catch(o){n="Error trying to get server response: "+o}this.processResponse(a,n)},processResponse:function(t,n){var a=t.data("file"),o=this,r={responseText:n};p(n,function(n){e.extend(r,{statusText:"OK",status:"200"}),o.upload._onFileProgress({target:e(a,o.upload.wrapper)},100),o.upload._onUploadSuccess({target:e(a,o.upload.wrapper)},n,r),o.cleanupFrame(t),o.unregisterFrame(t)},function(){e.extend(r,{statusText:"error",status:"500"}),o.upload._onUploadError({target:e(a,o.upload.wrapper)},r)})},onCancel:function(t){var n=e(t.target).data("frame");this.stopFrameSubmit(n),this.cleanupFrame(n),this.unregisterFrame(n),this.upload._removeFileEntry(n.data("file"))},onRetry:function(e){var t=m(e);this.performUpload(t)},onRemove:function(e,t){var n=m(e),a=n.data("frame");a?(this.unregisterFrame(a),this.upload._removeFileEntry(n),this.cleanupFrame(a)):l(n,this.upload,t)},onAbort:function(){var t=this.element,n=this;e.each(this.iframes,function(){e("input",this.data("form")).appendTo(t),n.stopFrameSubmit(this[0]),this.data("form").remove(),this.remove()}),this.iframes=[]},createFrame:function(t){return e("<iframe name='"+t+"'"+" id='"+t+"'"+" style='display:none;' />")},createForm:function(t,n){return e("<form enctype='multipart/form-data' method='POST' action='"+t+"'"+" target='"+n+"'"+"/>")},stopFrameSubmit:function(e){t!==e.stop?e.stop():e.document&&e.document.execCommand("Stop")},registerFrame:function(e){this.iframes.push(e)},unregisterFrame:function(t){this.iframes=e.grep(this.iframes,function(e){return e.attr("name")!=t.attr("name")})},cleanupFrame:function(e){var t=e.data("form");e.data("file").data("frame",null),setTimeout(function(){t.remove(),e.remove()},1)}},g=function(e){this.name="formDataUploadModule",this.element=e.wrapper,this.upload=e},g.prototype={onSelect:function(t,n){var a=this.upload,r=this,i=e(t.target),s=n?o(n):this.inputFiles(i),l=this.prepareUpload(i,s);e.each(l,function(){a.options.async.autoUpload?r.performUpload(this):(a._supportsRemove()&&a._fileAction(this,E),a._showUploadButton())})},prepareUpload:function(t,n){var a=this.enqueueFiles(n);return t.is("input")&&(e.each(a,function(){e(this).data("relatedInput",t)}),t.data("relatedFileEntries",a),this.upload._addInput(t)),a},enqueueFiles:function(t){var n,a,o,r,i=this.upload,s=t.length,l=[];if(i.options.async.batch===!0)n=e.map(t,function(e){return e.name}).join(", "),r=i._enqueueFile(n,{fileNames:t}),r.data("files",t),l.push(r);else for(a=0;s>a;a++)o=t[a],n=o.name,r=i._enqueueFile(n,{fileNames:[o]}),r.data("files",[o]),l.push(r);return l},inputFiles:function(e){return a(e)},performUpload:function(t){var n,a=this.upload,o=this.createFormData(t.data("files")),r=new XMLHttpRequest,i={files:t.data("fileNames"),XMLHttpRequest:r};if(a.trigger(b,i))this.removeFileEntry(t);else{a._fileAction(t,x),a._hideUploadButton(),i.data=e.extend({},i.data,h());for(n in i.data)o.append(n,i.data[n]);a._fileState(t,"uploading"),this.postFormData(a.options.async.saveUrl,o,t,r)}},onSaveSelected:function(){var t=this;e(".k-file",this.element).each(function(){var n=e(this),a=f(n);a||t.performUpload(n)})},onCancel:function(e){var t=m(e);this.stopUploadRequest(t),this.removeFileEntry(t)},onRetry:function(e){var t=m(e);this.performUpload(t)},onRemove:function(e,t){var n=m(e);n.children(".k-icon").is(".k-success")?l(n,this.upload,t):this.removeFileEntry(n)},postFormData:function(e,t,n,a){var o=this;n.data("request",a),a.addEventListener("load",function(e){o.onRequestSuccess.call(o,e,n)},!1),a.addEventListener(R,function(e){o.onRequestError.call(o,e,n)},!1),a.upload.addEventListener("progress",function(e){o.onRequestProgress.call(o,e,n)},!1),a.open("POST",e,!0),a.withCredentials="true",a.send(t)},createFormData:function(e){var t,n=new FormData,a=this.upload,o=e.length;for(t=0;o>t;t++)n.append(a.options.async.saveField||a.name,e[t].rawFile);return n},onRequestSuccess:function(t,n){function a(){r.upload._onUploadError({target:e(n,r.upload.wrapper)},o)}var o=t.target,r=this;o.status>=200&&o.status<=299?p(o.responseText,function(t){r.upload._onFileProgress({target:e(n,r.upload.wrapper)},100),r.upload._onUploadSuccess({target:e(n,r.upload.wrapper)},t,o),r.cleanupFileEntry(n)},a):a()},onRequestError:function(t,n){var a=t.target;this.upload._onUploadError({target:e(n,this.upload.wrapper)},a)},cleanupFileEntry:function(t){var n=t.data("relatedInput"),a=!0;n&&(e.each(n.data("relatedFileEntries")||[],function(){this.parent().length>0&&this[0]!=t[0]&&(a=a&&this.children(".k-icon").is(".k-success"))}),a&&n.remove())},removeFileEntry:function(e){this.cleanupFileEntry(e),this.upload._removeFileEntry(e)},onRequestProgress:function(t,n){var a=Math.round(100*t.loaded/t.total);this.upload._onFileProgress({target:e(n,this.upload.wrapper)},a)},stopUploadRequest:function(e){e.data("request").abort()}},_.ui.plugin(q)}(window.kendo.jQuery)});