("function"==typeof define&&define.amd?define:function(e,t){return t()})(["./kendo.list.min"],function(){(function(e,t){function n(e,t){var n;if(null===e&&null!==t||null!==e&&null===t)return!1;if(n=e.length,n!==t.length)return!1;for(;n--;)if(e[n]!==t[n])return!1;return!0}function i(e){var t=e.firstChild;return t&&"none"===t.style.display&&(t=l(t,x)),t}function a(e){var t=e.lastChild;return t&&"none"===t.style.display&&(t=l(t,k)),t}function l(e,t){return e=e[t],e&&"none"===e.style.display&&(e=l(e,t)),e}function r(t,n){t.filters&&(t.filters=e.grep(t.filters,function(e){return r(e,n),e.filters?e.filters.length:e.field!=n}))}var s=window.kendo,o=s.ui,u=o.List,c=s.keys,d=e.proxy,p="id",_="li",h="accept",f="filter",g="open",v="close",m="change",y="progress",T="select",x="nextSibling",k="previousSibling",S=' style="display:none"',b="aria-disabled",w="k-state-focused",C="k-state-hover",I="k-state-disabled",L="disabled",B=".kendoMultiSelect",D="click"+B,F="mouseenter"+B,E="mouseleave"+B,A=F+" "+E,H=/"/g,V=["font-family","font-size","font-stretch","font-style","font-weight","letter-spacing","text-transform","line-height"],W=u.extend({init:function(e,t){var n,i,a=this;a.ns=B,u.fn.init.call(a,e,t),a._wrapper(),a._tagList(),a._input(),a._textContainer(),a._loader(),a._tabindex(a.input),t=a.options,e=a.element.attr("multiple","multiple").hide(),t.placeholder||(t.placeholder=e.data("placeholder")),a.input.on("keydown"+B,d(a._keydown,a)).on("paste"+B,d(a._search,a)).on("focus"+B,function(){a._placeholder(!1)}).on("blur"+B,function(){a._placeholder(),a.close(),a._state===f&&(a._state=h)}),n=e.attr(p),n&&(a._tagID=n+"_tag_active",n+="_taglist",a.tagList.attr(p,n)),a._aria(n),a._dataSource(),a._accessors(),a._popup(),a._values=[],a._dataItems=[],i=t.value||e.val(),null===i&&(i=[]),a._old=a._initialValues=i,a._setInitialValues=!!i[0],a._reset(),a._enable(),a._placeholder(),t.autoBind&&a.dataSource.fetch(),s.notify(a)},options:{name:"MultiSelect",enable:!0,autoBind:!0,highlightFirst:!0,dataTextField:"",dataValueField:"",filter:"startswith",ignoreCase:!0,minLength:0,delay:100,maxSelectedItems:null,itemTemplate:"",tagTemplate:"",placeholder:"",height:200,animation:{}},events:[g,v,m,T,"dataBinding","dataBound"],setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.options.autoBind&&this.dataSource.fetch()},setOptions:function(e){u.fn.setOptions.call(this,e),this._template(),this._accessors(),this._aria(this.tagList.attr(p))},current:function(e){return this.currentTag(null),u.fn.current.call(this,e)},currentTag:function(e){var n=this;return e===t?n._currentTag:(n._currentTag&&(n._currentTag.removeClass(w).removeAttr(p),n.input.removeAttr("aria-activedescendant")),e&&(e.addClass(w).attr(p,n._tagID),n.input.attr("aria-activedescendant",n._tagID)),n._currentTag=e,t)},dataItems:function(){return this._dataItems},destroy:function(){var e=this,t=e.ns;e.wrapper.off(t),e.tagList.off(t),e.input.off(t),u.fn.destroy.call(e)},enable:function(t){var n=this,i=n.wrapper.off(B),a=n.tagList.off(B),l=n.input.add(n.element);t===!1?(i.addClass(I),l.attr(L,L).attr(b,!0)):(l.removeAttr(L).attr(b,!1),i.removeClass(I).on(A,n._toggleHover).on("mousedown"+B,function(e){e.preventDefault(),-1==e.target.className.indexOf("k-delete")&&n.open(),n.input[0]!==document.activeElement&&n.input.focus()}),a.on(F,_,function(){e(this).addClass(C)}).on(E,_,function(){e(this).removeClass(C)}).on(D,".k-delete",function(t){n._unselect(e(t.target).closest(_)),n._change(),n.close()}))},close:function(){this.popup.close(),this.current(null)},open:function(){var t=this;t.ul[0].firstChild&&t._state!==h?t._visibleItems&&t._allowSelection()&&(t.popup.open(),t.current(t.options.highlightFirst?e(i(t.ul[0])):null)):(t._state="",t._open=!0,t._filterSource())},toggle:function(e){this[e?g:v]()},refresh:function(){var t,n=this,a=null;n.trigger("dataBinding"),t=n._render(n.dataSource.view()),n._height(t),n._setInitialValues&&(n._setInitialValues=!1,n.value(n._initialValues)),n._open&&(n._open=!1,n.toggle(t)),n.popup.visible()&&n.options.highlightFirst&&(a=e(i(n.ul[0]))),n.current(a),n._touchScroller&&n._touchScroller.reset(),n._makeUnselectable(),n._hideBusy(),n.trigger("dataBound")},search:function(e){var t=this,n=t.options,i=n.ignoreCase,a=n.filter,l=n.dataTextField;clearTimeout(t._typing),e="string"==typeof e?e:t.input.val(),e.length>=n.minLength&&(t._state=f,t._open=!0,t._filterSource({value:i?e.toLowerCase():e,field:l,operator:a,ignoreCase:i}))},value:function(n){var i,a=this,l=e(a.tagList[0].children),r=l.length,s=0;if(n===t)return a._values;if(!a._fetchItems(n)){for(;r>s;s++)a._unselect(l.eq(s));if(null!==n){for(n=e.isArray(n)?n:[n],s=0,r=n.length;r>s;s++)i=a._index(n[s]),i>-1&&a._select(i);a._old=a._values.slice()}}},_dataSource:function(){var t=this,n=t.element,i=t.options,a=i.dataSource||{};a=e.isArray(a)?{data:a}:a,a.select=n,a.fields=[{field:i.dataTextField},{field:i.dataValueField}],t.dataSource&&t._refreshHandler?t._unbindDataSource():(t._refreshHandler=d(t.refresh,t),t._progressHandler=d(t._showBusy,t)),t.dataSource=s.data.DataSource.create(a).bind(m,t._refreshHandler).bind(y,t._progressHandler)},_fetchItems:function(e){var n=this;return n._fetch||n.ul[0].firstChild?t:(n.dataSource.one(m,function(){n.value(e),n._fetch=!1}),n._fetch=!0,n.dataSource.fetch(),!0)},_reset:function(){var e=this,t=e.element,n=t.closest("form");n[0]&&(e._resetHandler=function(){setTimeout(function(){e.value(e._initialValues)})},e._form=n.on("reset",e._resetHandler))},_filterSource:function(e){var t=this,n=t.options,i=t.dataSource,a=i.filter()||{};r(a,n.dataTextField),e&&(a=a.filters||[],a.push(e)),i.filter(a)},_change:function(){var e=this,t=e.value();n(t,e._old)||(e._old=t.slice(),e.trigger(m),e.element.trigger(m))},_click:function(n){var i=this,a=e(n.currentTarget);if(!n.isDefaultPrevented()){if(i.trigger(T,{item:a}))return i.close(),t;i._select(a),i._change(),i.close()}},_item:function(e,t){return e=e[t](),e[0]&&!e.is(":visible")&&(e=this._item(e,t)),e},_keydown:function(n){var r=this,s=n.keyCode,o=r._currentTag,u=r._current,d=r.input.val(),p=r.popup.visible();if(s===c.DOWN){if(n.preventDefault(),!p)return r.open(),t;u=u?l(u[0],x):r.ul[0].firstChild,u&&r.current(e(u))}else s===c.UP?(p&&(u=u?l(u[0],k):r.ul[0].lastChild,r.current(e(u)),r._current[0]||r.close()),n.preventDefault()):s===c.LEFT?d||(o=o?o.prev():e(r.tagList[0].lastChild),o[0]&&r.currentTag(o)):s===c.RIGHT?!d&&o&&(o=o.next(),r.currentTag(o[0]?o:null)):s===c.ENTER?p&&(r._select(u),r._change(),r.close(),n.preventDefault()):s===c.ESC?(p?n.preventDefault():r.currentTag(null),r.close()):s===c.HOME?p?r.current(e(i(r.ul[0]))):d||(o=r.tagList[0].firstChild,o&&r.currentTag(e(o))):s===c.END?p?r.current(e(a(r.ul[0]))):d||(o=r.tagList[0].lastChild,o&&r.currentTag(e(o))):s!==c.DELETE&&s!==c.BACKSPACE||d?r._search():(s!==c.BACKSPACE||o||(o=e(r.tagList[0].lastChild)),o&&o[0]&&(r._unselect(o),r._change(),r.close()))},_hideBusy:function(){var e=this;clearTimeout(e._busy),e._loading.hide(),e.input.attr("aria-busy",!1),e._busy=null},_showBusy:function(){var e=this;e._busy||(e._busy=setTimeout(function(){e.input.attr("aria-busy",!0),e._loading.show()},100))},_placeholder:function(e){var n=this,i=n.input;e===t&&(e=!1,i[0]!==document.activeElement&&(e=!n._dataItems[0])),i.toggleClass("k-readonly",e).val(e?n.options.placeholder:""),n._scale()},_scale:function(){var e=this,t=e.wrapper.width(),n=e._span.text(e.input.val()).width()+25;e.input.width(n>t?t:n)},_option:function(e,n){var i="<option",a=this._text(e),l=this._value(e);return l!==t&&(l+="",-1!==l.indexOf('"')&&(l=l.replace(H,"&quot;")),i+=' value="'+l+'"'),n&&(i+=' selected="selected"'),i+=">",a!==t&&(i+=s.htmlEncode(a)),i+="</option>"},_render:function(e){for(var t,n,i=this,a=e.length,l=i.itemTemplate,r=i._dataItems.slice(0),s=0,o=0,u="",c="";a>o;o++)t=e[o],n=i._selected(r,t),c+=l(t,o,n),u+=i._option(t,n),n||(s+=1);if(a=r.length)for(o=0;a>o;o++)u+=i._option(r[o],!0);return i.ul[0].innerHTML=c,i.element.html(u),i._visibleItems=s,s},_selected:function(e,n){var i,a=this,l=a._text,r=a._value,s=r(n),o=e.length,u=!1,c=0;for(s===t&&(s=l(n));o>c;c++)if(n=e[c],i=r(n),i===t&&(i=l(n)),i!==t&&i===s){u=!0;break}return u&&e.splice(c,1),u},_search:function(){var e=this;e._typing=setTimeout(function(){var t=e.input.val();e._prev!==t&&(e._scale(),e._prev=t,e.search(t))},e.options.delay)},_allowSelection:function(){var e=this.options.maxSelectedItems;return null===e||e>this._values.length},_select:function(e){var n,i,a,l=this,r=l._values;l._allowSelection()&&(isNaN(e)?a=e.hide().data("idx"):(a=e,l.ul[0].children[a].style.display="none"),l.element[0].children[a].selected=!0,n=l.dataSource.view()[a],l.tagList.append(l.tagTemplate(n)),l._dataItems.push(n),i=l._value(n),i===t&&(i=l._text(n)),r.push(i),l._visibleItems-=1,l.currentTag(null),l._placeholder(),l._state===f&&(l._state=h))},_unselect:function(n){var i,a,l,r,s,o=this,u=n.index();if(n.remove(),o.currentTag(null),i=o._dataItems.splice(u,1)[0],o._values.splice(u,1),a=o._value(i),a===t&&(a=o._text(i)),u=o._index(a),-1!==u)e(o.ul[0].children[u]).show(),o.element[0].children[u].selected=!1,o._visibleItems+=1;else for(u=o.dataSource.view().length,l=o.element[0].children,s=l.length;s>u;u++)if(r=l[u],r.value==a){r.selected=!1;break}o._placeholder()},_template:function(){var e,t=this,n=t.options,i=n.itemTemplate,a=n.tagTemplate,l=n.dataSource;t.element[0].length&&!l&&(n.dataTextField=n.dataTextField||"text",n.dataValueField=n.dataValueField||"value"),e=s.template("#:"+s.expr(n.dataTextField,"data")+"#",{useWithBlock:!1}),i=i?s.template(i):e,a=a?s.template(a):e,t.itemTemplate=function(e,t,n){return'<li tabindex="-1" role="option" data-idx="'+t+'" unselectable="on" class="k-item"'+(n?S:"")+">"+i(e)+"</li>"},t.tagTemplate=function(e){return'<li><span class="">'+a(e)+'</span><span class="k-icon k-delete">delete</span></li>'}},_input:function(){var t=this,n=t.element[0].accessKey,i=t._innerWrapper.children("input.k-input");i[0]||(i=e('<input class="k-input" style="width: 25px" />').appendTo(t._innerWrapper)),t.element.removeAttr("accesskey"),t._focused=t.input=i.attr({accesskey:n,role:"listbox","aria-expanded":!1})},_tagList:function(){var t=this,n=t._innerWrapper.children("ul.k-list");n[0]||(n=e('<ul role="listbox" unselectable="on" class="k-list k-reset"/>').appendTo(t._innerWrapper)),t.tagList=n},_loader:function(){this._loading=e('<span class="k-loading" style="display:none"></span>').insertAfter(this.input)},_textContainer:function(){var t=s.getComputedStyles(this.input[0],V);t.position="absolute",t.visibility="hidden",this._span=e("<span/>").css(t).appendTo(this.wrapper)},_wrapper:function(){var t=this,n=t.element,i=n.parent("span.k-multiselect");i[0]||(i=n.wrap('<div class="k-widget k-multiselect k-header" />').parent(),i[0].style.cssText=n[0].style.cssText,e('<div class="k-multiselect-wrap floatWrap" />').insertBefore(n)),t.wrapper=i.addClass(n[0].className).css("display",""),t._innerWrapper=e(i[0].firstChild)}});o.plugin(W)})(window.kendo.jQuery)});