("function"==typeof define&&define.amd?define:function(t,e){return e()})(["./kendo.scheduler.view.min"],function(){!function(t){function e(t){var e=new Date(1980,1,1,0,0,0);return i.date.setTime(e,u(t)),e}function n(t,e,n){var a=d({},i.Template,e.templateSettings),s=typeof t,r="";return"function"===s?r=i.template(t,a)(n||{}):"string"===s&&(r=t),r}function a(t,e,n){var a,i=e.getTime(),s=n.getTime();return a=t.getTime(),a>=i&&s>=a}var i=window.kendo,s=i.ui,r=s.SchedulerView,d=t.extend,o=t.proxy,l=i.date.getDate,h=i.date.MS_PER_MINUTE,c=i.date.MS_PER_DAY,u=i.date.getMilliseconds,m=i.date.isInTimeRange,f=".kendoMultiDayView",p=i.template('<div title="(#=kendo.format("{0:t} - {1:t}", start, end)#): #=title#"><dl><dt>#=kendo.format("{0:t} - {1:t}", start, end)#</dt><dd>${title}</dd></dl></div>'),v=i.template('<div title="(#=kendo.format("{0:t}", start)#): #=title#"><dl><dd>${title}</dd></dl></div>'),g=i.template("<span class='k-link k-nav-day'>#=kendo.toString(date, 'ddd M/dd')#</span>"),D='<div class="k-event" data-#=ns#uid="#=uid#"#if (resources[0]) { #style="background-color:#=resources[0].color #"#}#><span class="k-event-actions"># if(data.tail || data.middle) {#<span class="k-icon k-i-arrow-w"></span>#}## if(data.recurrence || data.recurrenceId) {#<a href="\\#" class="k-link"><span class="k-icon k-i-refresh"></span></a>#}#</span>{0}<span class="k-event-actions">#if (showDelete) {#<a href="\\#" class="k-link k-event-delete"><span class="k-icon k-i-close"></span></a>#}## if(data.head || data.middle) {#<span class="k-icon k-i-arrow-e"></span>#}#</span></div>',T=r.extend({init:function(t,e){var n=this;r.fn.init.call(n,t,e),n.title=n.options.title||n.options.name,n.eventTemplate=n._eventTmpl(n.options.eventTemplate),n.allDayEventTemplate=n._eventTmpl(n.options.allDayEventTemplate),n._editable(),n.calculateDateRange()},options:{name:"MultiDayView",selectedDateFormat:"{0:D}",allDaySlot:!0,title:"",startTime:i.date.today(),endTime:i.date.today(),minorTickCount:2,majorTick:60,majorTimeHeaderTemplate:i.template("#=kendo.toString(date, 't')#"),minorTimeHeaderTemplate:"&nbsp;",eventTemplate:p,allDayEventTemplate:v,dateHeaderTemplate:g,editable:!0},events:["remove","add","edit"],_editable:function(){var e=this;e.options.editable&&(e.element.on("click"+f,".k-event a:has(.k-i-close)",function(n){e.trigger("remove",{uid:t(this).closest(".k-event").attr(i.attr("uid"))}),n.preventDefault()}),e.options.editable.create!==!1&&e.element.on("dblclick"+f,".k-scheduler-content td",function(n){var a=t(this);e.trigger("add",{eventInfo:e._rangeToDates(a)}),n.preventDefault()}).on("dblclick"+f,".k-scheduler-header-all-day td",function(n){var a=t(this);e.trigger("add",{eventInfo:d({isAllDay:!0},e._rangeToDates(a))}),n.preventDefault()}),e.options.editable.update!==!1&&e.element.on("dblclick"+f,".k-event",function(n){e.trigger("edit",{uid:t(this).closest(".k-event").attr(i.attr("uid"))}),n.preventDefault()}))},_layout:function(t){var e,a,s=[],r=[],d=this.options;for(e=0;e<t.length;e++)a={},a.text=n(d.dateHeaderTemplate,d,{date:t[e]}),i.date.isToday(t[e])&&(a.className="k-today"),s.push(a);return d.allDaySlot&&r.push({text:"all day",allDay:!0}),this._forTimeRange(d.startTime,d.endTime,function(t,e){var a=e?d.majorTimeHeaderTemplate:d.minorTimeHeaderTemplate,i={text:n(a,d,{date:t}),className:e?"k-middle-row":""};r.push(i)}),{columns:s,rows:r}},_footer:function(){var e='<div class="k-header k-scheduler-footer">&nbsp;';e+="</div>",this.footer=t(e).appendTo(this.element)},_forTimeRange:function(t,n,a,s){t=e(t),n=e(n);var r,d,o=this,l=u(t),m=u(n),f=o.options.majorTick*h,p=f/o.options.minorTickCount||1,v=new Date(+t),g=v.getDate(),D=0,T="";for(d=c/p,l!=m&&(l>m&&(m+=c),d=(m-l)/p),d=Math.round(d);d>D;D++)T+=a(v,0===D%(f/p)),i.date.setTime(v,p,!1);return m&&(r=u(v),g<v.getDate()&&(r+=c),r>m&&(v=new Date(+n))),s&&(T+=s(v)),T},_content:function(t){var e=this,n=e.options,a=n.startTime,s=n.endTime,r="";r+="<tbody>",r+=this._forTimeRange(a,s,function(e,n){var a,s,r="";for(r="<tr"+(n?' class="k-middle-row"':"")+">",a=0,s=t.length;s>a;a++)r+="<td"+(i.date.isToday(t[a])?' class="k-today"':"")+">",r+="&nbsp;</td>";return r+="</tr>"}),r+="</tbody>",this.content.find("table").append(r)},_render:function(e){var n,a=this;e=e||[],this._dates=e,this._startDate=e[0],this._endDate=e[e.length-1||0],this.createLayout(this._layout(e)),this._content(e),this._footer(),this.refreshLayout(),n=this.element.find(".k-scheduler-header-all-day td"),n.length&&(this._allDayHeaderHeight=n.first()[0].clientHeight),a.datesHeader.on("click"+f,".k-nav-day",function(e){var n=t(e.currentTarget).closest("th");a.trigger("navigate",{view:"day",date:a._slotIndexDate(n.index())})})},startDate:function(){return this._startDate},endDate:function(){return this._endDate},nextDate:function(){return i.date.nextDay(this.endDate())},previousDate:function(){return i.date.previousDay(this.startDate())},calculateDateRange:function(){this._render([this.options.date])},destroy:function(){var t=this;t.datesHeader&&t.datesHeader.off(f),t.element&&t.element.off(f),r.fn.destroy.call(this),t.footer&&t.footer.remove()},_rangeToDates:function(t){var e,n=t.closest("tr"),a=n.closest("table").find("tr"),s=a.length-1,r=n.find("td").index(t),d=a.index(n),o=i.date.getDate(this._slotIndexDate(r));return o?(e=i.date.getDate(o),i.date.setTime(o,this._slotIndexTime(d)),i.date.setTime(e,this._slotIndexTime(Math.min(d+1,s))),{start:o,end:e}):null},_slotIndexTime:function(t){var e=this.options,n=u(e.startTime),a=e.majorTick/e.minorTickCount*h;return n+a*t},_slotIndexDate:function(t){var e,n,a,s=this._dates||[],r=u(new Date(+this.options.startTime)),d=u(new Date(+this.options.endTime));for(r>=d&&(d+=c),e=0,n=s.length;n>e;e++)if(a=new Date(+s[e]),i.date.setTime(a,r),t===e)return a;return null},_timeSlotIndex:function(t){var e=this.options,n=u(t),a=u(e.startTime),i=e.majorTick/e.minorTickCount*h;return(n-a)/i},_dateSlotIndex:function(t){var e,n,s,r,d=this._dates||[];for(e=0,n=d.length;n>e;e++)if(s=i.date.getDate(d[e]),r=new Date(i.date.getDate(d[e]).getTime()+c-1),a(t,s,r))return e;return-1},_calculateAllDayEventWidth:function(t,e){var n,a,i=this.element.find(".k-scheduler-header-all-day td"),s=0,r=t!==e?"outerWidth":"innerWidth";for(n=0,a=i.length;a>n;n++)n>=t&&e>=n&&(s+=i.eq(n)[r]());return s},_calculateEventHeight:function(t,e,n){var a,i,s=0;for(e===n&&(n+=1),a=0,i=t.length;i>a;a++)a>=e&&n>a&&(s+=t.eq(a).innerHeight());return s},_positionAllDayEvent:function(e,n,a,s){var d,o,l,h,c,u,m=n.eq(a),f=this._calculateAllDayEventWidth(a,s),p=r.collidingEvents(this.datesHeader.find(".k-event"),a,s).add(e),v=m.position().top,g=this._headerColumnCount||0,D=2,T=a!==s?5:4,k=this._allDayHeaderHeight;for(e.css({left:m.position().left+D,width:f-T}),e.attr(i.attr("start-end-idx"),a+"-"+s),d=r.createColumns(p,!0),o=0,l=d.length;l>o;o++)for(h=d[o].events,c=0,u=h.length;u>c;c++)t(h[c]).css({top:v+o*k});d.length&&d.length>g&&(this._updateAllDayHeaderHeight(k*d.length+k),this._headerColumnCount=d.length)},_arrangeColumns:function(e,n,a){var s,d,o,l,h,c=a.width(),u=.05*c,m=r.rangeIndex(e),f=this.content.children(".k-event["+i.attr("slot-idx")+"="+n+"]"),p=r.collidingEvents(f,m.start,m.end).add(e),v=r.createColumns(p),g=(c-u)/v.length;for(d=0,o=v.length;o>d;d++)for(s=v[d].events,l=0,h=s.length;h>l;l++)t(s[l]).css({width:g-4,left:a[0].offsetLeft+d*g+2})},_positionEvent:function(t,e,n,a){var s=Math.max(Math.floor(this._timeSlotIndex(t.start)),0),r=Math.min(Math.ceil(this._timeSlotIndex(t.end)),n.length),d=n.eq(Math.floor(s)),o=4,l=d.children().eq(a);s>=0&&0===r&&(r=n.length),e.css({height:this._calculateEventHeight(n,s,r)-o,top:d.position().top+this.content[0].scrollTop}),e.attr(i.attr("slot-idx"),a),e.attr(i.attr("start-end-idx"),s+"-"+r),this._arrangeColumns(e,a,l)},_eventTmpl:function(t){var e,n=this.options,a=d({},i.Template,n.templateSettings),s=a.paramName,r="",l=typeof t,h={storage:{},count:0};return"function"===l?(h.storage["tmpl"+h.count]=t,r+="#=this.tmpl"+h.count+"("+s+")#",h.count++):"string"===l&&(r+=t),e=i.template(i.format(D,r),a),h.count>0&&(e=o(e,h.storage)),e},_createEventElement:function(e,n){var a,s,r,o=this.options,h=o.editable&&o.editable.destroy!==!1,c=this.startDate(),u=this.endDate();return l(e.start)<l(c)&&l(e.end)>l(u)?a=!0:l(e.start)<l(c)?r=!0:l(e.end)>l(u)&&(s=!0),t(n(d({},{ns:i.ns,showDelete:h,middle:a,head:s,tail:r,resources:this.eventResources(e)},e)))},_isInTimeSlot:function(t){var e=this.options.startTime,n=this.options.endTime;return m(t.start,e,n)||m(t.end,e,n)||m(e,t.start,t.end)||m(n,t.start,t.end)},_isInDateSlot:function(t){var e=this.startDate(),n=new Date(this.endDate().getTime()+c-1);return a(t.start,e,n)||a(t.end,e,n)||a(e,t.start,t.end)||a(n,t.start,t.end)},_updateAllDayHeaderHeight:function(t){var e=this.element.find(".k-scheduler-header-all-day td");e.length&&e.parent().add(this.timesHeader.find(".k-scheduler-times-all-day").parent()).height(t)},render:function(t){var e,n,a,s,r,d,o,l,h=this.eventTemplate,u=this.allDayEventTemplate,m=this.content.find("tr"),f=this.element.find(".k-scheduler-header-all-day td"),p=this.datesHeader.find(".k-scheduler-header-wrap");for(this._headerColumnCount=0,this.element.find(".k-event").remove(),this._updateAllDayHeaderHeight(this._allDayHeaderHeight),t=new i.data.Query(t).sort([{field:"start",dir:"asc"},{field:"end",dir:"desc"}]).toArray(),n=0,a=t.length;a>n;n++)e=t[n],this._isInDateSlot(e)&&(s=this._dateSlotIndex(e.start),r=this._dateSlotIndex(e.end),d=!e.isAllDay&&e.end.getTime()-e.start.getTime()<c&&s===r,o=d?this.content:p,l=this._createEventElement(e,d?h:u),d?this._isInTimeSlot(e)&&(-1===s&&r>-1&&(s=r),this._positionEvent(e,l,m,s),l.appendTo(o)):(0>s&&(s=0),0>r&&(r=f.length-1),this._positionAllDayEvent(l,f,s,r),l.appendTo(o)));t.length&&this.refreshLayout()}});d(!0,s,{MultiDayView:T,DayView:T.extend({options:{title:"Day"},name:"day"}),WeekView:T.extend({options:{title:"Week",selectedDateFormat:"{0:D} - {1:D}"},name:"week",calculateDateRange:function(){var t,e,n=this.options.date,a=i.date.dayOfWeek(n,0,-1),s=[];for(t=0,e=7;e>t;t++)s.push(a),a=i.date.nextDay(a);this._render(s)}})})}(window.kendo.jQuery)});