("function"==typeof define&&define.amd?define:function(e,t){return t()})(["./kendo.dropdownlist.min","./kendo.editable.min","./kendo.multiselect.min","./kendo.window.min","./kendo.datepicker.min","./kendo.scheduler.recurrence.min","./kendo.scheduler.view.min","./kendo.scheduler.dayview.min","./kendo.scheduler.agendaview.min","./kendo.scheduler.monthview.min"],function(){!function(e){function t(e,t){return function(a){return a=e(a),i(a,"apply",t),a||[]}}function a(e,t){return function(a){return a&&("[object Array]"===D.call(a)||a instanceof p.data.ObservableArray||(a=[a])),i(a,"remove",t),a=e(a),a||[]}}function i(e,t,a){var i,n,r;for(e=e||[],n=0,r=e.length;r>n;n++)i=e[n],(i.startTimezone||i.endTimezone||a)&&(i.start=p.timezone[t](i.start,i.startTimezone||i.endTimezone||a),i.end=p.timezone[t](i.end,i.endTimezone||i.startTimezone||a));return e}function n(e,t){for(var a,i=e.length,n=0;i>n;n++)if(a=e[n],a.uid===t)return a}function r(e){return delete e.name,delete e.prefix,delete e.remove,delete e.edit,e}function d(e){var t,a,i=[];for(t=0,a=e.length;a>t;t++)i.push(e[t].toJSON());return i}function o(t){return function(a){e(p.format('<select data-{0}bind="value: {1}">',p.ns,t.field)).appendTo(a).kendoDropDownList({dataTextField:t.dataTextField,dataValueField:t.dataValueField,dataSource:t.dataSource,valuePrimitive:t.valuePrimitive,optionLabel:"None",template:p.format('<span class="k-scheduler-mark" style="background-color:#= data.{0}?{0}:"none" #"></span>#={1}#',t.dataColorField,t.dataTextField)})}}function l(t){return function(a){e(p.format('<select data-{0}bind="value: {1}">',p.ns,t.field)).appendTo(a).kendoMultiSelect({dataTextField:t.dataTextField,dataValueField:t.dataValueField,dataSource:t.dataSource,valuePrimitive:t.valuePrimitive,itemTemplate:p.format('<span class="k-scheduler-mark" style="background-color:#= data.{0}?{0}:"none" #"></span>#={1}#',t.dataColorField,t.dataTextField),tagTemplate:p.format('<span class="k-scheduler-mark" style="background-color:#= data.{0}?{0}:"none" #"></span>#={1}#',t.dataColorField,t.dataTextField)})}}var s,c,u,p=window.kendo,v=p.date,f=v.getDate,h=p.recurrence,m=p.ui,w=m.Widget,g="string",k=m.Popup,_=m.Calendar,b=e.isPlainObject,y=e.extend,S=e.proxy,D=Object.prototype.toString,x=e.isArray,E=".kendoScheduler",T="click",C="change",V="cancel",z="remove",H="save",F="add",N="edit",A=f(new Date),B="yyyyMMddTHHmmssZ",M="Are you sure you want to delete this event?",P='<a class="k-button #=className#" #=attr# href="\\#">#=text#</a>',R=p.template('<div class="k-floatwrap k-header k-scheduler-toolbar"><ul class="k-reset k-header k-toolbar k-scheduler-navigation"><li class="k-state-default k-nav-today"><a href="\\#" class="k-link">${messages.today}</a></li><li class="k-state-default k-nav-prev"><a href="\\#" class="k-link"><span class="k-icon k-i-arrow-w"></span></a></li><li class="k-state-default k-nav-next"><a href="\\#" class="k-link"><span class="k-icon k-i-arrow-e"></span></a></li><li class="k-state-default k-nav-current"><a href="\\#" class="k-link"><span class="k-icon k-i-calendar"></span><span data-#=ns#bind="text: formattedDate"></span></a></li></ul><ul class="k-reset k-header k-toolbar k-scheduler-views">#for(var view in views){#<li class="k-state-default k-view-#=view#" data-#=ns#name="#=view#"><a href="\\#" class="k-link">${views[view].title}</a></li>#}#</ul></div>'),W=function(t,a){e('<input type="text" required '+p.attr("type")+'="date"'+" "+p.attr("role")+'="datetimepicker" '+p.attr("bind")+'="value:'+a.field+',invisible:isAllDay" />').attr({name:a.field}).appendTo(t),e('<input type="text" required '+p.attr("type")+'="date"'+" "+p.attr("role")+'="datepicker" '+p.attr("bind")+'="value:'+a.field+',visible:isAllDay" />').attr({name:a.field}).appendTo(t),e("<span "+p.attr("for")+'="'+a.field+'" class="k-invalid-msg"/>').hide().appendTo(t)},q=function(t,a){e("<div "+p.attr("bind")+'="value:'+a.field+'" />').attr({name:a.field}).appendTo(t).kendoRecurrenceEditor({start:a.model.start})},O=p.Class.extend({init:function(i,n){var r=i.timezone;this.reader=n,n.model&&(this.model=n.model),this.timezone=r,this.data=t(e.proxy(this.data,this),r),this.serialize=a(e.proxy(this.serialize,this),r)},errors:function(e){return this.reader.errors(e)},parse:function(e){return this.reader.parse(e)},data:function(e){return this.reader.data(e)},total:function(e){return this.reader.total(e)},groups:function(e){return this.reader.groups(e)},aggregates:function(e){return this.reader.aggregates(e)},serialize:function(e){return this.reader.serialize(e)}}),I=p.data.Model.define({init:function(e){var t=this;p.data.Model.fn.init.call(t,e)},toJSON:function(){var e=p.data.Model.fn.toJSON.call(this);return e.uid=this.uid,e},fields:{title:{defaultValue:"",type:"string"},start:{type:"date",validation:{required:!0}},end:{type:"date",validation:{required:!0}},recurrence:{defaultValue:"",type:"string"},isAllDay:{type:"boolean",defaultValue:!1},description:{type:"string"}}}),j=p.data.DataSource.extend({init:function(e){p.data.DataSource.fn.init.call(this,y(!0,{},{schema:{modelBase:I,model:{}}},e)),this.reader=new O(this.options.schema,this.reader)}});j.create=function(e){e=e&&e.push?{data:e}:e;var t=e||{},a=t.data;if(t.data=a,!(t instanceof j)&&t instanceof p.data.DataSource)throw Error("Incorrect DataSource type. Only SchedulerDataSource instances are supported");return t instanceof j?t:new j(t)},y(!0,p.data,{SchedulerDataSource:j,SchedulerDataReader:O,SchedulerEvent:I}),s={update:{text:"Save",className:"k-scheduler-update"},canceledit:{text:"Cancel",className:"k-scheduler-cancel"},destroy:{text:"Delete",imageClass:"k-delete",className:"k-grid-delete",iconClass:"k-icon"}},c=w.extend({init:function(t,a){var i=this;w.fn.init.call(i,t,a),i.options.views&&i.options.views.length||(i.options.views=["day","week"]),i.resources=[],i._initModel(),i._wrapper(),i._views(),i._toolbar(),i._dataSource(),i._resources(),i._resizeHandler=S(i._resize,i),i.wrapper.on("mousedown"+E+" selectstart"+E,function(e){e.preventDefault()}),e(window).on("resize"+E,i._resizeHandler)},options:{name:"Scheduler",date:A,editable:!0,autoBind:!0,timezone:"",messages:{today:"Today",save:"Save",cancel:"Cancel",destroy:"Delete"},height:null,width:null,resources:[],views:[]},events:[z,N,V,H,"dataBinding","dataBound"],destroy:function(){var t,a=this;w.fn.destroy.call(a),a.dataSource&&a.dataSource.unbind(C,a._refreshHandler),a.calendar&&(a.calendar.destroy(),a.popup.destroy()),a.view()&&a.view().destroy(),a._destroyEditable(),t=a.element.add(a.wrapper).add(a.toolbar).add(a.popup),t.off(E),e(window).off("resize"+E,a._resizeHandler),p.destroy(a.wrapper)},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.options.autoBind&&e.fetch()},items:function(){return this.wrapper.children(".k-event, .k-task")},_modelForContainer:function(t){t=e(t).closest("["+p.attr("uid")+"]");var a=t.attr(p.attr("uid"));return this.dataSource.getByUid(a)},_showMessage:function(t,a){var i,n,r=this,d=p.format("<div><span>{0}</span>",t),o=this.options.messages,l=o.destroy,s=o.cancel;d+='<div class="k-edit-buttons">',d+=r._createButton({name:"destroy",text:l,attr:i})+r._createButton({name:"canceledit",text:s,attr:i}),d+="</div></div>",n=e(d).appendTo(this.wrapper).eq(0).on("click",".k-button",function(){e(this).hasClass("k-grid-delete")&&a(),n.close()}).kendoWindow({modal:!0,resizable:!1,draggable:!0,title:"Delete Event",visible:!1}).data("kendoWindow"),n.center().open()},_confirmation:function(e){var t=this,a=t.options.editable,i=a===!0||typeof a===g?M:a.confirmation;i!==!1&&null!=i?t._showMessage(i,e):e()},addEvent:function(e){var t,a;(this.editable&&this.editable.end()||!this.editable)&&(this.cancelEvent(),t=this.dataSource,a=t._createNewModel(),a instanceof p.data.Model?a.accept(e):a=y({title:""},a,e),a=this.dataSource.add(a),a&&this.editEvent(a.uid))},saveEvent:function(){var e=this,t=e._editContainer,a=e._modelForContainer(t),i=e.editable;t&&i&&i.end()&&!e.trigger(H,{container:t,model:a})&&e.dataSource.sync()},cancelEvent:function(){var e,t=this,a=t._editContainer;a&&(e=t._modelForContainer(a),t.dataSource.cancelChanges(e),t._destroyEditable())},editEvent:function(e){var t=this,a="string"==typeof e?t.dataSource.getByUid(e):e;t.cancelEvent(),!a||a.recurrence?t._createRecurringDialog(a,e):t._editEvent(a)},_editEvent:function(e){var t,a=this;a._createPopupEditor(e),t=a._editContainer,t.on(T+E,"a.k-scheduler-cancel",function(i){i.preventDefault(),i.stopPropagation(),a.trigger(V,{container:t,event:e})||a.cancelEvent()}),t.on(T+E,"a.k-scheduler-update",function(e){e.preventDefault(),e.stopPropagation(),a.saveEvent()})},_createButton:function(e){var t=e.template||P,a=typeof e===g?e:e.name||e.text,i={className:"k-scheduler-"+(a||"").replace(/\s/g,""),text:a,attr:""};if(!(a||b(e)&&e.template))throw Error("Custom commands should have name specified");return b(e)?(e.className&&(e.className+=" "+i.className),"edit"===a&&b(e.text)&&(e=y(!0,{},e),e.text=e.text.edit),i=y(!0,i,s[a],e)):i=y(!0,i,s[a]),p.template(t)(i)},_createPopupEditor:function(t){var a,i,n,r,d,s,c,u,v=this,f=v.options.editable,h="<div "+p.attr("uid")+'="'+t.uid+'" class="k-popup-edit-form k-scheduler-edit-form"><div class="k-edit-form-container">',m=f.template,w=v.options.messages,k=w.save,_=w.cancel,S=[{field:"title",title:"Title"},{field:"start",title:"Start",editor:W},{field:"end",title:"End",editor:W},{field:"isAllDay",title:"All day event"}],D=b(f)?f.window:{},x=y({},p.Template,v.options.templateSettings),E=[],T=x.paramName;if(m)typeof m===g&&(m=window.unescape(m)),h+=p.template(m,x)(t);else{"recurrence"in t&&S.push({field:"recurrence",title:"Repeat",editor:q}),"description"in t&&S.push({field:"description",title:"Description",editor:'<textarea name="description" class="k-textbox"/>'});for(i=0;i<v.resources.length;i++)n=v.resources[i],S.push({field:n.field,title:n.title,editor:n.multiple?l(n):o(n)});for(r=0,d=S.length;d>r;r++)s=S[r],h+='<div class="k-edit-label"><label for="'+s.field+'">'+(s.title||s.field||"")+"</label></div>",!t.editable||t.editable(s.field)?(E.push(s),h+="<div "+p.attr("container-for")+'="'+s.field+'" class="k-edit-field"></div>'):(c="#:",s.field?(s=p.expr(s.field,T),c+=s+"==null?'':"+s):c+="''",c+="#",c=p.template(c,x),h+='<div class="k-edit-field">'+c(t)+"</div>")}h+='<div class="k-edit-buttons k-state-default">',h+=v._createButton({name:"update",text:k,attr:a})+v._createButton({name:"canceledit",text:_,attr:a}),h+="</div></div></div>",u=v._editContainer=e(h).appendTo(v.wrapper).eq(0).kendoWindow(y({modal:!0,resizable:!1,draggable:!0,title:"Event",visible:!1,close:function(e){if(e.userTriggered){if(v.trigger(V,{container:u,event:t}))return e.preventDefault(),undefined;v.cancelEvent()}}},D)),v.editable=v._editContainer.kendoEditable({fields:E,model:t,clearContainer:!1,validateOnBlur:!0}).data("kendoEditable"),u.data("kendoWindow").center().open(),v.trigger(N,{container:u,event:t})},_createRecurringDialog:function(t,a){var i,r=this,d=!t,o=e("<div><button>Edit current occurrence</button><button>Edit the series</button></div>").appendTo(r.wrapper),l=o.find("button");d&&(t=n(r._data,a),i=r.dataSource.get(t.recurrenceId)),t&&(r._recurringDialog=o.kendoWindow({modal:!0,resizable:!1,draggable:!0,title:"Edit Recurring Item",visible:!1}).data("kendoWindow"),l.eq(0).on("click",function(){r._recurringDialog.destroy(),r._recurringDialog=null,d?(r._addExceptionDate(i,t.start),r.addEvent(t)):r._editEvent(t)}),l.eq(1).on("click",function(){r._recurringDialog.destroy(),r._recurringDialog=null,t.recurrenceId&&(t=r.dataSource.get(t.recurrenceId)),r._editEvent(t)}),r._recurringDialog.center().open())},_addExceptionDate:function(e,t){var a=e.exception||"";h.exceptionExists(a,t)||(t=p.timezone.apply(t,0),a+=p.toString(t,B)+";",e.set("exception",a))},_destroyEditable:function(){var e=this,t=function(){e.editable&&(e.editable.destroy(),e.editable=null,e._editContainer=null)};e.editable&&e._editContainer.data("kendoWindow").bind("deactivate",t).close()},removeEvent:function(e){var t="string"==typeof e?this.dataSource.getByUid(e):e,a=this;t&&this._confirmation(function(){a.trigger(z,{event:t})||a.dataSource.remove(t)&&a.dataSource.sync()})},_unbindView:function(e){e.destroy()},_bindView:function(e){var t=this;t.options.editable&&(t._viewRemoveHandler&&e.unbind(z,t._viewRemoveHandler),t._viewRemoveHandler=function(e){t.removeEvent(e.uid)},e.bind(z,t._viewRemoveHandler),t._viewAddHandler&&e.unbind(F,t._viewAddHandler),t._viewAddHandler=function(e){t.addEvent(e.eventInfo)},e.bind(F,this._viewAddHandler),t._viewEditHandler&&e.unbind(N,t._viewEditHandler),t._viewEditHandler=function(e){t.editEvent(e.uid)},e.bind(N,this._viewEditHandler),t._viewNavigateHandler&&e.unbind("navigate",t._viewNavigateHandler),t._viewNavigateHandler=function(e){e.view&&(t._selectView(e.view),t.date(e.date))},e.bind("navigate",t._viewNavigateHandler))},_selectView:function(e){var t=this;e&&t.views[e]&&(t._selectedView&&t._unbindView(t._selectedView),t._selectedView=t._renderView(e),t._selectedViewName=e,t.toolbar.find(".k-scheduler-views li").removeClass("k-state-selected").end().find(".k-view-"+e).addClass("k-state-selected"))},view:function(e){var t=this;return e?(t._selectView(e),t.rebind(),undefined):t._selectedView},_renderView:function(e){var t=this._initializeView(e);return this._bindView(t),this._model.set("formattedDate",t.dateForTitle()),t},_resize:function(){this.refresh()},_initializeView:function(e){var t,a,i=this.views[e];if(i){if(t=b(i),a=i.type,typeof a===g&&(a=p.getter(i.type)(window)),!a)throw Error("There is no such view");i=new a(this.wrapper,r(y({},this.options,t?i:{},{resources:this.resources,date:this.date()})))}return i},_views:function(){var e,t,a,i,n,r,d,o,l=this.options.views;for(this.views={},d=0,o=l.length;o>d;d++)e=l[d],i=b(e),i?(r=n=e.type?e.type:e,typeof r!==g&&(n=e.title)):r=n=e,t=u[n],t&&(e.type=t.type),e=y({title:n},t,i?e:{}),n&&(this.views[n]=e,(!a||e.selected)&&(a=n));a&&(this._selectedViewName=a)},rebind:function(){this.dataSource.fetch()},_dataSource:function(){var e=this,t=e.options,a=t.dataSource;a=x(a)?{data:a}:a,!t.timezone||a instanceof j||(a=y(!0,a,{schema:{timezone:t.timezone}})),e.dataSource&&e._refreshHandler?e.dataSource.unbind(C,e._refreshHandler):e._refreshHandler=S(e.refresh,e),e.dataSource=p.data.SchedulerDataSource.create(a).bind(C,e._refreshHandler)},_resources:function(){var t,a,i,n,r,d=this,o=d.options.resources;for(t=0;t<o.length;t++){if(a=o[t],i=a.field,n=a.dataSource,!i||!n)throw Error('The "field" and "dataSource" options of the scheduler resource are mandatory.');d.resources.push({field:i,title:a.title||i,dataTextField:a.dataTextField||"text",dataValueField:a.dataValueField||"value",dataColorField:a.dataColorField||"color",valuePrimitive:null!=a.valuePrimitive?a.valuePrimitive:!0,multiple:a.multiple||!1,dataSource:p.data.DataSource.create(n)})}r=e.map(d.resources,function(e){return e.dataSource.fetch()}),e.when.apply(null,r).then(function(){d.options.autoBind?d.view(d._selectedViewName):d._selectView(d._selectedViewName)})},_initModel:function(){var e=this;e._model=p.observable({selectedDate:this.options.date,formattedDate:""}),e._model.bind("change",function(t){"selectedDate"===t.field&&e.view(e._selectedViewName)})},_wrapper:function(){var e=this,t=e.options.height;e.wrapper=e.element,e.wrapper.addClass("k-widget k-scheduler k-floatwrap"),t&&e.wrapper.css("height",t)},date:function(e){return null!=e&&this._model.set("selectedDate",e),f(this._model.get("selectedDate"))},_toolbar:function(){var t=this,a=t.options,i=e(R({messages:a.messages,ns:p.ns,views:t.views}));t.wrapper.append(i),t.toolbar=i,p.bind(t.toolbar,t._model),i.on(T+E,".k-scheduler-navigation li",function(a){var i=e(this),n=new Date(t.date());if(a.preventDefault(),i.hasClass("k-nav-today"))n=new Date;else if(i.hasClass("k-nav-next"))n=t.view().nextDate();else if(i.hasClass("k-nav-prev"))n=t.view().previousDate();else if(i.hasClass("k-nav-current"))return t._showCalendar(),undefined;t.date(n)}),i.on(T+E,".k-scheduler-views li",function(a){t.view(e(this).attr(p.attr("name"))),a.preventDefault()})},_showCalendar:function(){var t=this,a=t.toolbar.find(".k-nav-current"),i=e('<div><div class="k-scheduler-calendar"/></div>');t.popup||(t.popup=new k(i,{anchor:a,activate:function(){t.calendar||(t.calendar=new _(this.element.find(".k-scheduler-calendar"),{change:function(){t.date(this.value()),t.popup.close()}})),t.calendar.value(t.date())},copyAnchorStyles:!1})),t.popup.open()},_expandEvents:function(e,t){var a=t.endDate(),i=t.endTime;return h?(a=new Date(a),i?a.setHours(i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()):a.setHours(23,59,59,999),e=h.expandAll(e,t.startDate(),a,this.dataSource.reader.timezone)):e=d(e),e},_createFilter:function(e,t){var a=p.date.MS_PER_DAY,i={};return e&&t&&(i={logic:"or",filters:[{logic:"and",filters:[{field:"start",operator:"gte",value:e},{field:"end",operator:"gte",value:e},{field:"start",operator:"lte",value:new Date(t.getTime()+a-1)}]},{logic:"and",filters:[{field:"start",operator:"lte",value:new Date(e.getTime()+a-1)},{field:"end",operator:"gte",value:e}]}]}),i},refresh:function(e){var t=this.view(),a=this.dataSource.view();e&&"itemchange"===e.action&&this.editable||(this.trigger("dataBinding"),this._destroyEditable(),this._data=a=this._expandEvents(a,t),a=new p.data.Query(a).filter(this._createFilter(t.startDate(),t.endDate())).toArray(),t.render(a),this.trigger("dataBound"))}}),u={day:{type:"kendo.ui.DayView",title:"Day"},week:{type:"kendo.ui.WeekView",title:"Week"},agenda:{type:"kendo.ui.AgendaView",title:"Agenda"},month:{type:"kendo.ui.MonthView",title:"Month"}},m.plugin(c)}(window.kendo.jQuery)});