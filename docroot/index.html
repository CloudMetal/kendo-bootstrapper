<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="kendo/css/kendo.common.css" />
    <link rel="stylesheet" type="text/css" href="kendo/css/kendo.default.css" />
    <script src="kendo/js/jquery.min.js"></script>
    <script src="kendo/js/kendo.web.min.js"></script>

    <link rel="stylesheet/less" href="css/app.less" />

    <script src="js/utils.js"></script>
    <script src="js/rpc.js"></script>
    <script src="js/less-1.3.3.min.js"></script>
    <script src="js/yajet.min.js"></script>

    <script src="app.js"></script>
  </head>

  <body>

    <div id="top-layout">
      <div id="main-layout">
        <div id="projects-and-files" class="sections vertical">
          <div id="projects" class="section">
            <div class="title">Projects</div>
            <div class="k-toolbar">
              <button class="k-button" id="btn-project-new">New</button>
              <button class="k-button" id="btn-project-preview">Preview</button>
            </div>
            <div id="project-list"></div>
          </div>
          <div id="files" class="section">
            <div class="title">No project selected</div>
            <div class="k-toolbar">
              <button class="k-button" id="btn-file-new">New file</button>
              <button class="k-button" id="btn-file-delete">Delete file</button>
            </div>
            <div id="project-file-tree"><div></div></div>
          </div>
        </div>
        <div id="content">

        </div>
      </div>
    </div>

    <!-- TEMPLATES -->

    <script type="x/yajet-template" class="simple-list-item">
      <div class="simple-list-item" value="${this.id}">${this.name}</div>
    </script>

    <script type="x/yajet-template" class="project-view">
      <!-- main project view -->
      $( var p = this )
      <h1>$p.project_name|html</h1>

      $(BLOCK plink(file, text)$-
        $(LET ((info => p.file_info[file])
               (date => info && info.date))
          <a target="PROJECTPREVIEW"
             title="$date|html"
             href="${ p.make_link(file) => html }">${ text || file => html }</a>$)$)

      $(BLOCK display_files(FILES)
        $(BLOCK showlist(type, title)
          $(AWHEN (FILES[type])
            <h3>$title</h3>
            <div class="files-${type}"><ul>
              $(FOREACH (f => it)
                <li>
                  ${ plink(f) }
                  $(LET ((finfo => p.file_info[f]))
                    (${ finfo.size } bytes)
                    $(WHEN (!finfo.library && finfo.canbuild)
                      →
                      $(AIF (finfo.build)
                        <span class="build">
                          ${ plink(it.rel) } ($it.size bytes)$-
                          $(WHEN (it.dirty), <span class="warn">outdated</span>$)
                        </span>
                      $(ELSE)
                        <span class="warn">not built</span>
                      $)
                    $)
                  $)
                </li>
              $)
            </ul></div>
          $)
        $)
        <div class="files">
          ${ showlist("html", "HTML files") }
          ${ showlist("js", "JavaScript files") }
          ${ showlist("css", "CSS files") }
          ${ showlist("less", "LESS files") }
        </div>
      $)

      <h2>
        Project files —
        <button onclick="rebuildProject('$p.id|html')"
                class="k-button">rebuild all</button>
        <button onclick="projectAddFile('$p.id|html')"
                class="k-button">add file</button>
      </h2>
      ${ display_files(p.files) }

      <h2>Library files</h2>
      ${ display_files(p.min_files) }
    </script>

    <script type="x/yajet-template" class="add-file-dialog">
      $( var p = this )
      <form action="/@add-file/$p.id|html/"
            target="--add-file"
            method="POST"
            enctype="multipart/form-data">
        <input type="hidden" name="project" value="$p.id|html" />
        <input type="hidden" name="expect" value="$p.expect|html" />
        <p>
          <label>
            File name (relative to project directory):<br />
            <input class="k-input k-editable" name="filename" style="width: 25em" type="text" />
          </label>
        </p>
        <p style="text-align: center">
          <label class="display-full-path">$p.path|html</label>
        </p>
        <p>
          <label>
            Upload content (optional):<br />
            <input type="file" name="file" />
          </label>
        </p>
        <p>
          <label>
            <input type="checkbox" name="library" />
            This is a library file
          </label>
        </p>
        <div class="dlg-buttons">
          <button class="k-button btn-ok">OK</button>
          <button class="k-button btn-cancel">Cancel</button>
        </div>
      </form>
      <iframe id="--add-file" style="display: none" src="about:blank"></iframe>
    </script>

    <script type="x/yajet-template" class="confirm-dialog">
      <p style="font-size: 120%; font-weight: bold">
        $this.message|html
      </p>
      <div class="dlg-buttons">
        <button class="k-button btn-ok">${ this.okLabel || "OK" => html }</button>
        <button class="k-button btn-cancel">${ this.cancelLabel || "Cancel" => html }</button>
      </div>
    </script>

  </body>
</html>
