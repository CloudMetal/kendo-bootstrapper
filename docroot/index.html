<!DOCTYPE html>
<html>
  <head>
    <title>Kendo UI bootstrapper</title>

    <link rel="stylesheet" type="text/css" href="kendo/css/kendo.common.css" />
    <link rel="stylesheet" type="text/css" href="kendo/css/kendo.default.css" />
    <script src="kendo/js/jquery.min.js"></script>
    <script src="kendo/js/kendo.web.min.js"></script>

    <link rel="stylesheet/less" href="css/app.less" />

    <script src="js/utils.js"></script>
    <script src="js/rpc.js"></script>
    <script src="js/less-1.3.3.min.js"></script>
    <script src="js/yajet.min.js"></script>

    <script src="app.js"></script>
  </head>

  <body>

    <div id="top-layout">
      <div id="main-layout">
        <div id="projects-and-files" class="sections vertical">
          <div id="projects" class="section">
            <div class="title">Projects</div>
            <div class="k-toolbar">
              <button class="k-button" id="btn-project-new">New</button>
              <button class="k-button" id="btn-project-preview">Preview</button>
            </div>
            <div id="project-list"></div>
          </div>
          <div id="files" class="section">
            <div class="title">No project selected</div>
            <div class="k-toolbar">
              <button class="k-button" id="btn-file-new">New file</button>
              <button class="k-button" id="btn-file-edit">Edit file</button>
              <button class="k-button" id="btn-file-delete">Delete file</button>
            </div>
            <div id="project-file-tree"><div></div></div>
          </div>
        </div>
        <div id="content">

        </div>
      </div>
    </div>

    <!-- TEMPLATES -->

    <script type="x/yajet-template" class="simple-list-item">
      <div class="simple-list-item" value="${this.id}">${this.name}</div>
    </script>

    <script type="x/yajet-template" class="project-view">
      <!-- main project view -->
      $( var p = this )
      <div>
        <div style="float: right">
          <button onclick="projectRefreshContent('$p.id|html')"
                  class="k-button">refresh</button>
          <button onclick="projectEditDependencies('$p.id|html')"
                  class="k-button">dependencies</button>
          <button onclick="rebuildProject('$p.id|html')"
                  class="k-button">rebuild all</button>
          <button onclick="projectAddFile('$p.id|html')"
                  class="k-button">add file</button>
          <button onclick="projectBuildKendo('$p.id|html')"
                  class="k-button">build kendo</button>
          |
          <button onclick="projectBuildDistro('$p.id|html')"
                  class="k-button">build distro</button>
        </div>
        <h1>$p.project_name|html</h1>
      </div>

      $(BLOCK plink(file, text)$-
        $(LET ((info => p.file_info[file])
               (date => info && info.date))
          <a target="PROJECTPREVIEW"
             title="$date|html"
             href="${ p.make_link(file) => html }">${ text || file => html }</a>$)$)

      $(BLOCK display_files(files_by_type)
        $(MAPHASH (type, files => files_by_type)
          <tr class="file-type">
            <td>$type (project files)</td>
            <td>$type (library files)</td>
          </tr>
          $(BLOCK showfiles(lib)
            $(AWHEN (files.filter(function(f){ return !!f.lib == !!lib }))
              <ul>
                $(FOREACH (f => it)
                  <li>
                    ${ plink(f.name) }
                    $(LET ((finfo => p.file_info[f.name]))
                      (${ finfo.size } bytes$-
                      $(WHEN (!f.lib)$-
                        ; <a href="#" command="edit-file" project-id="$p.id|html" filename="$f.name|html">edit</a>$))
                      $(WHEN (!finfo.library && finfo.canbuild)
                        â†’
                        $(AIF (finfo.build)
                          <span class="build">
                            ${ plink(it.rel) } ($it.size bytes)$-
                            $(WHEN (it.dirty), <span class="warn">outdated</span>$)
                          </span>
                        $(ELSE)
                          <span class="warn">not built</span>
                        $)
                      $)
                    $)
                  </li>
                $)
              </ul>
            $)
          $)
          <tr>
            <td>
              ${ showfiles(false) }
            </td>
            <td>
              ${ showfiles(true) }
            </td>
          </tr>
        $)
      $)

      <table class="project-files">
        ${ display_files(p.files) }
      </table>
    </script>

    <script type="x/yajet-template" class="add-file-dialog">
      $( var p = this )
      <form action="/@add-file/$p.id|html/"
            target="--add-file"
            method="POST"
            enctype="multipart/form-data">
        <input type="hidden" name="project" value="$p.id|html" />
        <input type="hidden" name="expect" value="$p.expect|html" />
        <p>
          <label>
            File name (relative to project directory):<br />
            <input autocomplete="off" class="k-input k-editable" name="filename" style="width: 25em" type="text" />
          </label>
        </p>
        <p style="text-align: center">
          <label class="display-full-path">$p.path|html</label>
        </p>
        <p>
          <label>
            Upload content (optional):<br />
            <input type="file" name="file" />
          </label>
        </p>
        <p>
          <label>
            <input type="checkbox" name="library" />
            This is a library file
          </label>
        </p>
        $(PROCESS ok_cancel_buttons())
      </form>
      <iframe id="--add-file" style="display: none" src="about:blank"></iframe>
    </script>

    <script type="x/yajet-template" class="new-project-dialog">
      <p>
        <label>
          Project name:<br />
          <input autocomplete="off" name="name" style="width: 25em" class="k-input k-editable" type="text" />
        </label>
      </p>
      <p>
        <label>
          Project directory:<br />
          <input autocomplete="off" name="path" style="width: 25em"
                 class="k-input k-editable" type="text"
                 value="${ this.destination => html }/" />
        </label>
      </p>
      <p>
        <label>
          Project ID:<br />
          <input autocomplete="off" name="id" style="width: 10em" class="k-input k-editable" type="text" />
        </label>
      </p>
      $(PROCESS ok_cancel_buttons())
    </script>

    <script type="x/yajet-template" class="confirm-dialog">
      <p style="font-size: 120%; font-weight: bold">
        $this.message|html
      </p>
      $(PROCESS ok_cancel_buttons())
    </script>

    <script type="x/yajet-template" class="build-errors-dialog">
      <table class="build-errors">
        <thead>
          <tr>
            <td>File</td>
            <td>Error</td>
            <td>Location</td>
          </tr>
        </thead>
        <tbody>
          $(FOREACH (err => this.errors)
            <tr>
              <td><b>${ err.filename => html }</b></td>
              <td>${ err.message => html }</td>
              <td><a href="#" command="edit-file"
                     project-id="$this.proj_id"
                     filename="$err.filename|html"
                     line="$err.line"
                     $(AIF (err.col) col="$it"$)>line $err.line$(AIF (err.col), col $it$)</a></td>
            </tr>
          $)
        </tbody>
      </table>
      <div class="dlg-buttons">
        <button class="k-button btn-close">Close</button>
      </div>
    </script>

    <script type="x/yajet-template" class="project-deps-dialog">
      <div class="project-deps-dialog">
        <div class="project-deps">
          <div class="left-files"></div>
          <div class="deps" style="display: none">
            <p><b>Select below direct dependencies of <span class="filename"></span></b>:</p>
            <div class="deps-select"></div>
          </div>
        </div>
        $(PROCESS ok_cancel_buttons())
      </div>
    </script>

    <script type="x/yajet-template" class="kendo-widget-usage">
      <div style="max-height: 400px; overflow: auto">
        <p>Based on your code we detected that the following Kendo UI widgets
        are in use:</p>

        <ul class="two-columns">$(FOREACH (w => this.widgets) <li>$w|html</li> $)</ul>

        $(AIF (this.manual)
          <p>Manually selected:</p>
          <ul class="two-columns">$(FOREACH (w => it) <li>$w|html</li> $)</ul>$)

        <p>We auto-selected these components.  If you require additional
        components please mark them below.  Dependencies will be added
        in automatically.</p>

        <div class="two-columns">
          $(FOREACH (comp => this.kcomp)
            $(WHEN (comp.category == "web" || comp.category == "framework")
              <div>
                $( var checked = this.selection.indexOf(comp.id) >= 0
                                 ? 'checked="checked"' : ''; )
                <label class="hovering"
                       title="${ comp.description || 'No description provided' => html }">
                  <input id="kcomp-$comp.id|html" type="checkbox" value="$comp.id|html" $checked />
                  $comp.name|html ($comp.category|html)
                </label>
              </div>$)$)
        </div>
      </div>

      $(PROCESS ok_cancel_buttons())
    </script>

    <script type="x/yajet-template" class="template-library">
      $(EXPORT ok_cancel_buttons()
        <div class="dlg-buttons">
          <button class="k-button btn-ok">${ this.okLabel || "OK" => html }</button>
          <button class="k-button btn-cancel">${ this.cancelLabel || "Cancel" => html }</button>
        </div>$)
    </script>

  </body>
</html>
